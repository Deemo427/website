var Festival=ExtraView.extend({namespace:'festival',extraOnEnter:function($container){var _this=this;initHeaderTitle($container);festivalInitClouds($container);initSectionTitle($container);initScrollContent($container);this.imagesLoaded=!0;$window.trigger("extra:responsiveImage:init",[$container])},getTimelineIn:function(){var deferred=Barba.Utils.deferred(),$container=$(this.container),timeline=new TimelineMax();timeline.add(function(){transitionIn($container)});timeline.add(function(){festivalInitJury($container)});timeline.staggerFrom($container.find('.header .cloud'),1.2,{yPercent:20,opacity:0,ease:Back.easeOut.config(1)},0.2,0);timeline.call(function(){deferred.resolve();$(window).trigger("extra:resize")});return{deferred:deferred.promise,timeline:timeline}},getTimelineOut:function(){return transitionOut()}});Festival.init();function festivalInitClouds($container){var
isActive=!0,$window=$(window),scrollTop=0,lastScroll=0,allowUpdate=!1,$cloud=$container.find('.header .cloud'),$wrapper=$container.find('.header-wrapper'),wWidth=0,wHeight=0,material=new THREE.MeshPhongMaterial({color:0xffffff,shading:THREE.FlatShading}),fov=35,url=$cloud.data("url"),cloud,renderer,scene,camera,loader=new THREE.OBJLoader();scene=new THREE.Scene();camera=new THREE.PerspectiveCamera(fov,wWidth/wHeight);camera.position.set(0,0,5);renderer=new THREE.WebGLRenderer({resolution:1,alpha:!0,antialias:!0});renderer.setSize(wWidth,wHeight);renderer.setPixelRatio(1);$cloud.append(renderer.domElement);var light=new THREE.HemisphereLight(0xFFFFFF,0x69a070,1);light.position.set(5,5,2);scene.add(light);var pointLight=new THREE.PointLight(0x63b06d,0.6,8);pointLight.position.set(-2,-2,2);pointLight.castShadow=!1;scene.add(pointLight);function init(){scene.add(cloud);cloud.material=material;cloud.castShadow=!1;cloud.receiveShadow=!1;renderer.clear();allowUpdate=!0;render()}
function render(){if(!isActive){return}
requestAnimationFrame(render);if(!allowUpdate){return}
var percent=scrollTop/wHeight;camera.position.set(0,percent*5,5);camera.lookAt(new THREE.Vector3(0,0,0));camera.fov=35+percent*10;camera.updateProjectionMatrix();renderer.render(scene,camera);lastScroll=scrollTop;allowUpdate=!1}
loader.load(url,function(object){object.traverse(function(child){if(child instanceof THREE.Mesh){child.material=material}});cloud=object;init()});$window.on("scroll",scrollHandler);function scrollHandler(){scrollTop=$window.scrollTop();allowUpdate=!0}
function resizeHandler(event){wWidth=$wrapper.outerWidth();wHeight=$wrapper.outerHeight();renderer.setSize(wWidth,wHeight);camera.aspect=wWidth/wHeight;camera.updateProjectionMatrix();scrollTop=$window.scrollTop();allowUpdate=!0}
$(window).on("extra:resize",resizeHandler);resizeHandler();function destroy(){if(!isActive||app.currentContainer===$container[0]){return}
isActive=!1;cloud.parent.remove(cloud);cloud=null;renderer=null;camera=null;scene=null;$window.off("extra:resize",resizeHandler);$window.off("scroll",scrollHandler)}
Barba.Dispatcher.on("transitionCompleted",destroy)}function festivalInitJury($container){var
$window=$(window),$wrapper=$container.find('.jury-wrapper'),$slider=$wrapper.find(".jury-slider"),$sliderInner=$wrapper.find(".jury-slider-inner"),$items=$sliderInner.children(),$dragger=$wrapper.find('.dragger'),$handle=$dragger.find('.handle'),slider,sliderSnap=[],draggerSnap=[],viewableItems=1,sliderWidth=0,sliderInnerWidth=0,itemWidth=0,dragger,handleWidth=40,tmpSliderX=0,draggerWidth=0,isActive=!0;$items.not('.fixed').shuffle();$items=$sliderInner.children();slider=Draggable.create($sliderInner,{type:'x',dragClickables:!0,bounds:$slider,throwProps:!0,onDrag:sliderUpdateHandler,onThrowUpdate:sliderUpdateHandler})[0];function sliderUpdateHandler(){tmpSliderX=this.x;updateEverything(-(this.x/(sliderInnerWidth-sliderWidth)),'slider')}
dragger=Draggable.create($handle,{type:'x',dragClickables:!0,bounds:$dragger,throwProps:!0,maxDuration:3,onDrag:draggerUpdateHandler,onThrowUpdate:draggerUpdateHandler})[0];function draggerUpdateHandler(){updateEverything(this.x/(draggerWidth-handleWidth),'dragger')}
function updateEverything(percent,source){if(source!=='dragger'){var handleTargetX=(draggerWidth-handleWidth)*-percent;TweenMax.set($handle,{x:-handleTargetX})}
if(source!=='slider'){tmpSliderX=-(((sliderInnerWidth-(itemWidth*viewableItems)))*percent);TweenMax.set($sliderInner,{x:tmpSliderX})}}
function windowResizeHandler(){var wWidth=window.innerWidth,tmpSliderX=slider.x,tmpDraggerX=dragger.x;TweenMax.set($sliderInner,{x:0});TweenMax.set($handle,{x:0});sliderWidth=$slider.width();sliderInnerWidth=$sliderInner.width();draggerWidth=$dragger.width();if(wWidth>1800){viewableItems=5}else if(wWidth>1280){viewableItems=3}else if(wWidth>960){viewableItems=2}else if(wWidth>690&&wWidth<=960){viewableItems=1}else{viewableItems=1}
itemWidth=sliderWidth/viewableItems;TweenMax.set($items,{width:itemWidth});var sliderOffset=$slider.offset().left;sliderSnap=[];draggerSnap=[];var sliderRatio=((draggerWidth-handleWidth)/(sliderInnerWidth-sliderWidth));$sliderInner.children().each(function(index,item){var itemLeft=$(item).offset().left-sliderOffset;sliderSnap.push(-Math.min(itemLeft,sliderInnerWidth-sliderWidth));draggerSnap.push(Math.min(draggerWidth-handleWidth-1,itemLeft*sliderRatio))});slider.vars.snap=sliderSnap;dragger.vars.snap=draggerSnap;tmpSliderX=0;TweenMax.set($sliderInner,{x:tmpSliderX});TweenMax.set($handle,{x:tmpDraggerX});slider.update();dragger.update()}
$window.on("extra:resize",windowResizeHandler);windowResizeHandler();function destroy(){if(!isActive||app.currentContainer===$container[0]){return}
isActive=!1;$window.off("extra:resize",windowResizeHandler)}
Barba.Dispatcher.on("transitionCompleted",destroy)}