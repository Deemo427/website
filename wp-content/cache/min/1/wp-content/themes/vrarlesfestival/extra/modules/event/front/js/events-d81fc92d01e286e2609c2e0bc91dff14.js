var Events=ExtraView.extend({namespace:'events',extraOnEnter:function($container){var _this=this;eventsInitSlider($container);initHeaderTitle($container);eventsInitClouds($container);initSectionTitle($container);this.imagesLoaded=!0;$window.trigger("extra:responsiveImage:init",[$container]);TweenMax.set($container,{clearProps:'visibility'})},getTimelineIn:function(){var deferred=Barba.Utils.deferred(),$container=$(this.container),timeline=new TimelineMax();timeline.add(function(){transitionIn($container)});timeline.staggerFrom($container.find('.header .cloud'),1.2,{yPercent:20,opacity:0,ease:Back.easeOut.config(1)},0.2,0);timeline.call(function(){deferred.resolve()});timeline.add(function(){$container.trigger("event:transitionincomplete")});return{deferred:deferred.promise,timeline:timeline}},getTimelineOut:function(){return transitionOut()}});Events.init();function eventsInitClouds($container){var
isActive=!0,$window=$(window),scrollTop=0,allowUpdate=!1,$cloud=$container.find('.header .cloud'),$wrapper=$container.find('.header-wrapper'),wWidth=0,wHeight=0,material=new THREE.MeshPhongMaterial({color:0xffffff,shading:THREE.FlatShading}),renderers=[],childs=[],fov=35,url=$cloud.data("url"),renderer,scene,camera,loader=new THREE.OBJLoader();scene=new THREE.Scene();camera=new THREE.PerspectiveCamera(fov,wWidth/wHeight);camera.position.set(0,0,5);renderer=new THREE.WebGLRenderer({resolution:1,alpha:!0,antialias:!0});renderer.setSize(wWidth,wHeight);renderer.setPixelRatio(1);$cloud.append(renderer.domElement);renderers.push({renderer:renderer,camera:camera});var light=new THREE.HemisphereLight(0xFFFFFF,0x69a070,1);light.position.set(5,5,2);scene.add(light);var pointLight=new THREE.PointLight(0x63b06d,0.6,2,2);pointLight.position.set(0.4,0.1,0.4);pointLight.castShadow=!1;scene.add(pointLight);function init(){childs.forEach(function(child,index){if(index===0){child.aTargetPosition=[-3,1,-2];child.aTargetRotation=[0,-3,0.2]}else if(index===1){child.aTargetPosition=[-0.5,1,-2];child.aTargetRotation=[-0.3,1,0]}else if(index===2){child.aTargetPosition=[1,-0.2,0.3];child.aTargetRotation=[1,0,0]}else if(index===3){child.aTargetPosition=[0.5,0.5,1];child.aTargetRotation=[0,0.4,1]}
scene.add(child)});renderer.clear();allowUpdate=!0;render()}
function render(){if(!isActive){return}
requestAnimationFrame(render);if(!allowUpdate){return}
var percent=scrollTop/wHeight;childs.forEach(function(child,index){child.position.set(child.aTargetPosition[0]*percent,child.aTargetPosition[1]*percent,child.aTargetPosition[2]*percent);child.rotation.set(child.aTargetRotation[0]*percent,child.aTargetRotation[1]*percent,child.aTargetRotation[2]*percent)});renderer.render(scene,camera);allowUpdate=!1}
loader.load(url,function(object){object.traverse(function(child){if(child instanceof THREE.Mesh){child.material=material;child.castShadow=!1;child.receiveShadow=!1;childs.push(child)}});init()});function scrollHandler(){scrollTop=$window.scrollTop();allowUpdate=!0}
$window.on("scroll",scrollHandler);function resizeHandler(event){wWidth=$wrapper.outerWidth();wHeight=$wrapper.outerHeight();var scale=window.innerWidth/1920+0.3;childs.forEach(function(child,index){child.scale.set(scale,scale,scale)});renderers.forEach(function(renderer){renderer.renderer.setSize(wWidth,wHeight);renderer.camera.aspect=wWidth/wHeight;renderer.camera.updateProjectionMatrix()});scrollHandler()}
$(window).on("extra:resize",resizeHandler);resizeHandler();function destroy(){if(!isActive||app.currentContainer===$container[0]){return}
isActive=!1;childs.forEach(function(child){child.parent.remove(child);child=null});childs=null;scene=null;renderer=null;camera=null;$window.off("extra:resize",resizeHandler);$window.off("scroll",scrollHandler)}
Barba.Dispatcher.on("transitionCompleted",destroy)}function eventsInitSlider($container){var
isActive=!0,$window=$(window),$linksWrapper=$container.find('.event-navigation-inner'),$links=$linksWrapper.find('.event-date-link'),$list=$container.find('.event-list'),$wrapper=$list.find('.event-list-inner'),$items=$wrapper.find('.event-detail-wrapper'),currentIndex=-1,isDragging=!1,isTransitioning=!1,dragger,$dragger=$container.find('.dragger'),$handle=$container.find('.handle');dragger=Draggable.create($handle,{type:'x',dragClickables:!0,bounds:$dragger,throwProps:!0,maxDuration:1,minimumMovement:0,lockAxis:!1,onDragStart:function(){isDragging=!0},onThrowComplete:function(){isDragging=!1;var _this=this;_this.vars.snap.forEach(function(value,index){if(_this.x===value){moveTo(index)}})}})[0];$links.each(function(index,item){var $link=$(this);$link.on("click",function(event){event.preventDefault();if(isTransitioning||isDragging||index===currentIndex){return}
isTransitioning=!0;var timeline=new TimelineMax();timeline.to($handle,0.3,{opacity:0,scale:0,ease:Strong.easeIn});timeline.set($handle,{x:dragger.vars.snap[index],clearProps:'opacity'});timeline.to($handle,0.5,{scale:1,ease:Strong.easeOut});timeline.add(function(){dragger.update()});moveTo(index)})});function moveTo(index){var
$target=$items.eq(index),$title=$target.find('.background-title'),$letters=$title.find('.letter'),$mask=$target.find('.mask'),$separator=$target.find('.separator'),$link=$links.eq(index),transition=new TimelineMax();transition.set($letters,{yPercent:function(index){return((index%2)?-110:110)}});transition.set($mask,{scaleX:1});transition.set($separator,{scaleX:0});transition.to($wrapper,1,{xPercent:-(index*100),ease:Power3.easeInOut});transition.call(function(){isTransitioning=!1});transition.addLabel("current",'-=0.6');transition.staggerTo($mask,1,{scaleX:0,ease:Power3.easeInOut},0.1,'current');transition.staggerTo($separator,1,{scaleX:1,ease:Power3.easeInOut},0.1,'current+=0.2');transition.staggerTo($letters,1,{yPercent:0},0.1,'current+=0.4');$link.addClass('active');$links.eq(currentIndex).removeClass('active');currentIndex=index;TweenMax.to($list,0.3,{height:Math.max(window.innerHeight,$target.height()),onComplete:function(){$(window).trigger("resize")}})}
function resizeHandler(){var snap=[2],wrapperOffset=$linksWrapper.offset().left;$links.not(':first').not(':last').each(function(){var $link=$(this),left=Math.round($link.offset().left-wrapperOffset+2);snap.push(left)});snap.push(Math.round($linksWrapper.width()-44));dragger.vars.snap=snap;dragger.update()}
$(window).on("extra:resize",resizeHandler);resizeHandler();TweenMax.set($handle,{x:dragger.vars.snap[0]});dragger.update();if(window.location.hash){var index=window.location.hash.replace(/[^\d]/g,'');$links.eq(index-1).trigger("click");$window.on("event:transitionincomplete",scrollToSlider)}else{$links.first().trigger("click")}
function scrollToSlider(){TweenMax.to(window,2,{ease:Quad.easeOut,scrollTo:$linksWrapper.offset().top-100,delay:0.1})}
function destroy(){if(!isActive||app.currentContainer===$container[0]){return}
isActive=!1;$window.off("extra:resize",resizeHandler);$window.off("event:transitionincomplete",scrollToSlider)}
Barba.Dispatcher.on("transitionCompleted",destroy)}