(function(){'use strict';var $=jQuery;var $window=$(window);var $document=$(document);var extend=$.extend;var isFn=$.isFunction;var mathMax=Math.max;var mathMin=Math.min;var mathRound=Math.round;var getId=(function(){var ids={};var nextId=1;return function(element){if(!element){return 0}
if(!ids[element]){ids[element]=nextId;nextId+=1}
return ids[element]}}());function isTypeOf(obj,type){return typeof obj===type}
function isInstanceOf(obj,type){return obj instanceof type}
function isHTMLElement(obj){return obj&&obj.nodeType}
function getHTMLElement(obj){return isHTMLElement(obj)?obj:(isInstanceOf(obj,$)?obj[0]:undefined)}
function reduce(elements,fn,current){$.each(elements,function(idx,element){current=fn.call(element,current,idx,element)});return current}
function equal(obj1,obj2,props){var i,l,prop;if(obj1===obj2){return!0}
if(!obj1||!obj2||obj1.constructor!==obj2.constructor){return!1}
for(i=0,l=props.length;i<l;i+=1){prop=props[i];if(obj1[prop]&&isFn(obj1[prop].equals)&&!obj1[prop].equals(obj2[prop])){return!1}
if(obj1[prop]!==obj2[prop]){return!1}}
return!0}
function Rect(left,top,width,height){this.left=mathRound(left);this.top=mathRound(top);this.width=mathRound(width);this.height=mathRound(height);this.right=this.left+this.width;this.bottom=this.top+this.height}
extend(Rect.prototype,{equals:function(that){return equal(this,that,['left','top','width','height'])},area:function(){return this.width*this.height},relativeTo:function(rect){return new Rect(this.left-rect.left,this.top-rect.top,this.width,this.height)},intersection:function(rect){if(!isInstanceOf(rect,Rect)){return null}
var left=mathMax(this.left,rect.left);var right=mathMin(this.right,rect.right);var top=mathMax(this.top,rect.top);var bottom=mathMin(this.bottom,rect.bottom);var width=right-left;var height=bottom-top;return(width>=0&&height>=0)?new Rect(left,top,width,height):null},envelope:function(rect){if(!isInstanceOf(rect,Rect)){return this}
var left=mathMin(this.left,rect.left);var right=mathMax(this.right,rect.right);var top=mathMin(this.top,rect.top);var bottom=mathMax(this.bottom,rect.bottom);var width=right-left;var height=bottom-top;return new Rect(left,top,width,height)}});extend(Rect,{ofContent:function(element,inContentSpace){if(!element||element===document||element===window){return new Rect(0,0,$document.width(),$document.height())}
if(inContentSpace){return new Rect(0,0,element.scrollWidth,element.scrollHeight)}else{return new Rect(element.offsetLeft-element.scrollLeft,element.offsetTop-element.scrollTop,element.scrollWidth,element.scrollHeight)}},ofViewport:function(element,inContentSpace){if(!element||element===document||element===window){return new Rect($window.scrollLeft(),$window.scrollTop(),$window.width(),$window.height())}
if(inContentSpace){return new Rect(element.scrollLeft,element.scrollTop,element.clientWidth,element.clientHeight)}else{return new Rect(element.offsetLeft,element.offsetTop,element.clientWidth,element.clientHeight)}},ofElement:function(element){var $element=$(element);if(!$element.is(':visible')){return null}
var offset=$element.offset();return new Rect(offset.left,offset.top,$element.outerWidth(),$element.outerHeight())}});function Fractions(visible,viewport,possible,rects){this.visible=visible||0;this.viewport=viewport||0;this.possible=possible||0;this.rects=(rects&&extend({},rects))||null}
extend(Fractions.prototype,{equals:function(that){return this.fracsEqual(that)&&this.rectsEqual(that)},fracsEqual:function(that){return equal(this,that,['visible','viewport','possible'])},rectsEqual:function(that){return equal(this.rects,that.rects,['document','element','viewport'])}});extend(Fractions,{of:function(rect,viewport){var intersection,intersectionArea,possibleArea;rect=(isHTMLElement(rect)&&Rect.ofElement(rect))||rect;viewport=(isHTMLElement(viewport)&&Rect.ofViewport(viewport))||viewport||Rect.ofViewport();if(!(rect instanceof Rect)){return new Fractions()}
intersection=rect.intersection(viewport);if(!intersection){return new Fractions()}
intersectionArea=intersection.area();possibleArea=mathMin(rect.width,viewport.width)*mathMin(rect.height,viewport.height);return new Fractions(intersectionArea/rect.area(),intersectionArea/viewport.area(),intersectionArea/possibleArea,{document:intersection,element:intersection.relativeTo(rect),viewport:intersection.relativeTo(viewport)})}});function Group(elements,viewport){this.els=elements;this.viewport=viewport}
var rectProps=['width','height','left','right','top','bottom'];var fracsProps=['possible','visible','viewport'];function getValue(element,viewport,property){var obj;if($.inArray(property,rectProps)>=0){obj=Rect.ofElement(element)}else if($.inArray(property,fracsProps)>=0){obj=Fractions.of(element,viewport)}
return obj?obj[property]:0}
function sortAscending(entry1,entry2){return entry1.val-entry2.val}
function sortDescending(entry1,entry2){return entry2.val-entry1.val}
extend(Group.prototype,{sorted:function(property,descending){var viewport=this.viewport;return $.map(this.els,function(element){return{el:element,val:getValue(element,viewport,property)}}).sort(descending?sortDescending:sortAscending)},best:function(property,descending){return this.els.length?this.sorted(property,descending)[0]:null}});function ScrollState(element){var content=Rect.ofContent(element,!0);var viewport=Rect.ofViewport(element,!0);var w=content.width-viewport.width;var h=content.height-viewport.height;this.content=content;this.viewport=viewport;this.width=w<=0?null:viewport.left/w;this.height=h<=0?null:viewport.top/h;this.left=viewport.left;this.top=viewport.top;this.right=content.right-viewport.right;this.bottom=content.bottom-viewport.bottom}
extend(ScrollState.prototype,{equals:function(that){return equal(this,that,['width','height','left','top','right','bottom','content','viewport'])}});function Viewport(element){this.el=element||window}
extend(Viewport.prototype,{equals:function(that){return equal(this,that,['el'])},scrollState:function(){return new ScrollState(this.el)},scrollTo:function(left,top,duration){var $el=this.el===window?$('html,body'):$(this.el);left=left||0;top=top||0;duration=isNaN(duration)?1000:duration;$el.stop(!0).animate({scrollLeft:left,scrollTop:top},duration)},scroll:function(left,top,duration){var $el=this.el===window?$window:$(this.el);left=left||0;top=top||0;this.scrollTo($el.scrollLeft()+left,$el.scrollTop()+top,duration)},scrollToRect:function(rect,paddingLeft,paddingTop,duration){paddingLeft=paddingLeft||0;paddingTop=paddingTop||0;this.scrollTo(rect.left-paddingLeft,rect.top-paddingTop,duration)},scrollToElement:function(element,paddingLeft,paddingTop,duration){var rect=Rect.ofElement(element).relativeTo(Rect.ofContent(this.el));this.scrollToRect(rect,paddingLeft,paddingTop,duration)}});var callbacksMixIn={init:function(){this.callbacks=$.Callbacks('memory unique');this.currVal=null;this.prevVal=null;this.checkProxy=$.proxy(this.check,this);this.autoCheck()},bind:function(callback){this.callbacks.add(callback)},unbind:function(callback){if(callback){this.callbacks.remove(callback)}else{this.callbacks.empty()}},trigger:function(){this.callbacks.fireWith(this.context,[this.currVal,this.prevVal])},check:function(event){var value=this.updatedValue(event);if(value===undefined){return!1}
this.prevVal=this.currVal;this.currVal=value;this.trigger();return!0},$autoTarget:$window,autoEvents:'load resize scroll',autoCheck:function(on){this.$autoTarget[on===!1?'off':'on'](this.autoEvents,this.checkProxy)}};function FracsCallbacks(element,viewport){this.context=element;this.viewport=viewport;this.init()}
extend(FracsCallbacks.prototype,callbacksMixIn,{updatedValue:function(){var value=Fractions.of(this.context,this.viewport);if(!this.currVal||!this.currVal.equals(value)){return value}}});function GroupCallbacks(elements,viewport,property,descending){this.context=new Group(elements,viewport);this.property=property;this.descending=descending;this.init()}
extend(GroupCallbacks.prototype,callbacksMixIn,{updatedValue:function(){var best=this.context.best(this.property,this.descending);if(best){best=best.val>0?best.el:null;if(this.currVal!==best){return best}}}});function ScrollStateCallbacks(element){if(!element||element===window||element===document){this.context=window}else{this.context=element;this.$autoTarget=$(element)}
this.init()}
extend(ScrollStateCallbacks.prototype,callbacksMixIn,{updatedValue:function(){var value=new ScrollState(this.context);if(!this.currVal||!this.currVal.equals(value)){return value}}});function modplug(t,n){"use strict";function e(n,e,u,s){return u=r(u)?u.apply(n,e):u,r(s[u])?s[u].apply(n,e):void i.error('Method "'+u+'" does not exist on jQuery.'+t)}function u(t){t&&(o(c,t.statics),o(l,t.methods)),c.modplug=u}var s=[].slice,i=jQuery,o=i.extend,r=i.isFunction,a=o({},n),c=function d(){return e(this,s.call(arguments),a.defaultStatic,d)},l=function f(t){return r(f[t])?f[t].apply(this,s.call(arguments,1)):e(this,s.call(arguments),a.defaultMethod,f)};u.prev={statics:i[t],methods:i.fn[t]},u(n),i[t]=c,i.fn[t]=l};var namespace='fracs';modplug(namespace,{statics:{version:'0.15.1',Rect:Rect,Fractions:Fractions,Group:Group,ScrollState:ScrollState,Viewport:Viewport,FracsCallbacks:FracsCallbacks,GroupCallbacks:GroupCallbacks,ScrollStateCallbacks:ScrollStateCallbacks,fracs:function(rect,viewport){return Fractions.of(rect,viewport)}},methods:{content:function(inContentSpace){return this.length?Rect.ofContent(this[0],inContentSpace):null},envelope:function(){return reduce(this,function(current){var rect=Rect.ofElement(this);return current?current.envelope(rect):rect})},fracs:function(action,callback,viewport){if(!isTypeOf(action,'string')){viewport=callback;callback=action;action=null}
if(!isFn(callback)){viewport=callback;callback=null}
viewport=getHTMLElement(viewport);var ns=namespace+'.fracs.'+getId(viewport);if(action==='unbind'){return this.each(function(){var cbs=$(this).data(ns);if(cbs){cbs.unbind(callback)}})}else if(action==='check'){return this.each(function(){var cbs=$(this).data(ns);if(cbs){cbs.check()}})}else if(isFn(callback)){return this.each(function(){var $this=$(this),cbs=$this.data(ns);if(!cbs){cbs=new FracsCallbacks(this,viewport);$this.data(ns,cbs)}
cbs.bind(callback)})}
return this.length?Fractions.of(this[0],viewport):null},intersection:function(){return reduce(this,function(current){var rect=Rect.ofElement(this);return current?current.intersection(rect):rect})},max:function(property,callback,viewport){if(!isFn(callback)){viewport=callback;callback=null}
viewport=getHTMLElement(viewport);if(callback){new GroupCallbacks(this,viewport,property,!0).bind(callback);return this}
return this.pushStack(new Group(this,viewport).best(property,!0).el)},min:function(property,callback,viewport){if(!isFn(callback)){viewport=callback;callback=null}
viewport=getHTMLElement(viewport);if(callback){new GroupCallbacks(this,viewport,property).bind(callback);return this}
return this.pushStack(new Group(this,viewport).best(property).el)},rect:function(){return this.length?Rect.ofElement(this[0]):null},scrollState:function(action,callback){var ns=namespace+'.scrollState';if(!isTypeOf(action,'string')){callback=action;action=null}
if(action==='unbind'){return this.each(function(){var cbs=$(this).data(ns);if(cbs){cbs.unbind(callback)}})}else if(action==='check'){return this.each(function(){var cbs=$(this).data(ns);if(cbs){cbs.check()}})}else if(isFn(callback)){return this.each(function(){var $this=$(this),cbs=$this.data(ns);if(!cbs){cbs=new ScrollStateCallbacks(this);$this.data(ns,cbs)}
cbs.bind(callback)})}
return this.length?new ScrollState(this[0]):null},scroll:function(left,top,duration){return this.each(function(){new Viewport(this).scroll(left,top,duration)})},scrollTo:function(element,paddingLeft,paddingTop,duration){if($.isNumeric(element)){duration=paddingTop;paddingTop=paddingLeft;paddingLeft=element;element=null}
element=getHTMLElement(element);return this.each(function(){if(element){new Viewport(this).scrollToElement(element,paddingLeft,paddingTop,duration)}else{new Viewport(this).scrollTo(paddingLeft,paddingTop,duration)}})},scrollToThis:function(paddingLeft,paddingTop,duration,viewport){viewport=new Viewport(getHTMLElement(viewport));viewport.scrollToElement(this[0],paddingLeft,paddingTop,duration);return this},softLink:function(paddingLeft,paddingTop,duration,viewport){viewport=new Viewport(getHTMLElement(viewport));return this.filter('a[href^=#]').each(function(){var $a=$(this);$a.on('click',function(){viewport.scrollToElement($($a.attr('href'))[0],paddingLeft,paddingTop,duration)})})},sort:function(property,ascending,viewport){if(!isTypeOf(ascending,'boolean')){viewport=ascending;ascending=null}
viewport=getHTMLElement(viewport);return this.pushStack($.map(new Group(this,viewport).sorted(property,!ascending),function(entry){return entry.el}))},viewport:function(inContentSpace){return this.length?Rect.ofViewport(this[0],inContentSpace):null}},defaultStatic:'fracs',defaultMethod:'fracs'})}())